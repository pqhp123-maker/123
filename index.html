<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Malware Analysis</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'primary-dark': '#111827',
            'secondary-dark': '#1f2937',
            'accent-blue': '#3b82f6',
            'accent-red': '#ef4444',
            'accent-green': '#10b981',
          },
          fontFamily: { sans: ['Inter', 'sans-serif'] },
        }
      }
    }
  </script>
</head>
<body class="bg-primary-dark text-gray-100 min-h-screen font-sans flex items-start justify-center p-6">

  <div class="w-full max-w-4xl bg-secondary-dark rounded-xl shadow-2xl p-8">
    <h1 class="text-3xl font-extrabold text-white mb-4">Malware Analysis</h1>
    <p class="text-gray-400 mb-6">Upload a file for static analysis.</p>

    <!-- Upload Form -->
    <div id="upload-section" class="p-6 border border-gray-700 rounded-lg bg-gray-800 mb-6">
      <input id="file-upload" type="file" class="mb-4 block w-full text-gray-300" />
      <button id="submit-button" onclick="uploadFile()" disabled
        class="w-full py-3 rounded-lg font-bold text-lg bg-accent-blue hover:bg-blue-700 text-white disabled:bg-gray-600">
        Analyze File
      </button>
    </div>

    <!-- Message -->
    <div id="message-box" class="hidden p-4 rounded-lg text-center font-medium mb-6"></div>

    <!-- Results -->
    <div id="results-container" class="hidden">
      <h2 class="text-2xl font-bold mb-3">Analysis Report</h2>
      <pre id="report-output" class="bg-gray-900 p-4 rounded-lg text-sm overflow-x-auto"></pre>
    </div>
  </div>

  <script>
    const API_ENDPOINT = "/api/get_static/";

    const fileUpload = document.getElementById('file-upload');
    const submitButton = document.getElementById('submit-button');
    const messageBox = document.getElementById('message-box');
    const resultsContainer = document.getElementById('results-container');
    const reportOutput = document.getElementById('report-output');

    let selectedFile = null;

    fileUpload.addEventListener('change', (e) => {
      selectedFile = e.target.files[0];
      submitButton.disabled = !selectedFile;
    });

    function showMessage(msg, type="info") {
      messageBox.textContent = msg;
      messageBox.className = "p-4 rounded-lg text-center font-medium mb-6";
      if (type === "error") messageBox.classList.add("bg-red-900/50","text-red-400");
      if (type === "success") messageBox.classList.add("bg-green-900/50","text-green-400");
      if (type === "loading") messageBox.classList.add("bg-blue-900/50","text-blue-400");
      messageBox.classList.remove("hidden");
    }

    async function uploadFile() {
      if (!selectedFile) {
        showMessage("Please select a file first", "error");
        return;
      }
      showMessage(`Uploading "${selectedFile.name}"...`, "loading");
      resultsContainer.classList.add("hidden");

      const formData = new FormData();
      formData.append("raw_data", selectedFile);

      try {
        const res = await fetch(API_ENDPOINT, { method: "POST", body: formData });
        if (!res.ok) {
          const err = await res.text();
          showMessage("Analysis Failed: " + err, "error");
          return;
        }
        const report = await res.json();
        reportOutput.textContent = JSON.stringify(report, null, 2);
        showMessage("Analysis Complete!", "success");
        resultsContainer.classList.remove("hidden");
      } catch (err) {
        console.error(err);
        showMessage("Network error: " + err.message, "error");
      }
    }
  </script>

</body>
</html>
